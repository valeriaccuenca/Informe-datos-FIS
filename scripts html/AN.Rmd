---
title: "Informe desigualdades sociales relativas en salud - Andalucía"
subtitle: "Proyecto FIS XX"
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(ggplot2)
setwd(getwd())

```

```{=html}
<style>
body, p {
font-family: Arial;
}
</style>
```
El presente informe muestra la evolución de las desigualdades sociales relativas, en función del nivel educativo, para diferentes factores de riesgo de enfermedad cardiovascular en Andalucía desde el año 2001 hasta el 2020, utilizando los datos de la Encuesta Nacional de Salud en España/Encuesta Europea de Salud en España.

Este informe se enmarca dentro del Proyecto FIS XX financiado por XX

```{r, echo=F}

desigualdades_rii_spain <- read.csv("rii_spain.csv")
prevalencias_spain <- read.csv("prevalencias_spain.csv")

prevalencias_ccaa <- read.csv("prevalencias_ccaa.csv")

prevalencias_ca <- prevalencias_ccaa %>%
  filter(abreviatura=="AN") %>%
  mutate(educa=case_when(education_3==1~"Bajo", 
                         education_3==2~"Medio", 
                         education_3==3~"Alto"), 
         educa=factor(educa, levels=c("Bajo", "Medio", "Alto")))

prevalencias_ca <- prevalencias_ccaa %>%
  filter(abreviatura == "AN")

desigualdades_rii_ccaa <- read.csv("rii_ccaa.csv")
desigualdades_ca <- desigualdades_rii_ccaa %>%
  filter(abreviatura == "AN")

```

## Diabetes {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

figura1_an <-  
prevalencias_ca %>%
  filter(sexo=="Overall") %>%
  ggplot(aes(x=encuesta, y=diabetes*100, color=educa, 
             ymin=diabetes_low*100, ymax=diabetes_upp*100))+
  geom_point()+
  geom_errorbar(alpha=0.3)+
  geom_line()+
  #scale_x_date(date_labels = "%Y")+
  labs(x="Año", y="Prevalencia de diabetes (IC 95%)")+
  guides(color=guide_legend(title="Nivel educativo"))+
  theme_bw()
figura1_an

desigualdades_an %>%
  filter(fr =="diabetes", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="diabetes", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="diabetes", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

## Hipertensión arterial {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="hta", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")
```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="hta", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="hta", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

## Obesidad {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="obesity", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")
```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="obesity", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="obesity", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

## Colesterol {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="col", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")
```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="col", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="col", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

## Sedentario {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="sedentario", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")
```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="sedentario", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="sedentario", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

## Tabaquismo {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="smoking", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")
```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="smoking", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="smoking", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

## Alcohol {.tabset .tabset-fade .tabset-pills}

### Global

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="alcohol", sexo=="Overall") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")
```

### Hombres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="alcohol", sexo=="Hombre") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```

### Mujeres

```{r, echo=F}

desigualdades_ca %>%
  filter(fr =="alcohol", sexo=="Mujeres") %>%
  ggplot(aes(x=as.Date(encuesta), y=rii, ymin=rii_infci, ymax=rii_supci, group=fr)) +
  geom_hline(yintercept = 1, lty = 2) +
  geom_ribbon(alpha=0.3, aes(fill=fr)) +
  geom_line(aes(color=fr)) +
  scale_y_continuous(trans="log", breaks=c(0.75, 1, 1.5, 2, 4, 8, 16, 32))+
  scale_x_date(date_labels = "%Y", breaks = unique(as.Date(desigualdades_ca$encuesta)))+
  labs(x="", y="RII (IC 95%)")+
  theme_bw()+
  theme(axis.text=element_text(size=20, color="black"),
                  axis.title=element_text(size=20, face="bold", color="black"),
                  axis.text.x = element_text(angle = 90),
                  strip.text = element_text(size=20, face="bold", color="black"),
                  legend.position="none")

```
